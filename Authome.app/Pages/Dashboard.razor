@page "/"
@using AutHome.Shared
@using Microsoft.AspNetCore.SignalR.Client
@inject NavigationManager NavigationManager

<PageTitle>Dashboard</PageTitle>

<TemperatureCard
    DeviceName="Temperatura MCU"
    AccentColor="#de922f"
    InputScale=@TemperatureCard.TemperatureScale.Fahrenheit
    OutputScale=@TemperatureCard.TemperatureScale.Celsius
    InputTemperature=@mcuTemperature/>

<TemperatureCard
    DeviceName="Temperatura DHT"
    AccentColor="#00aa00"
    InputScale=@TemperatureCard.TemperatureScale.Celsius
    OutputScale=@TemperatureCard.TemperatureScale.Celsius
    InputTemperature=@dhtTemperature/>

<HumidityCard
    DeviceName="Umiditá DHT"
    AccentColor="#00aa00"
    InputHumidity=@dhtHumidity/>

@code {
    private int? mcuTemperature = null;
    private int? dhtTemperature = null;
    private int? dhtHumidity = null;

    private HubConnection? hubConnection;

    protected override async Task OnInitializedAsync()
    {
        hubConnection = new HubConnectionBuilder()
            .WithUrl(NavigationManager.ToAbsoluteUri("/controlhub"))
            .Build();

        hubConnection.On<int>("MicrocontrollerTemperature", (temperature) =>
        {
            mcuTemperature = temperature;
            InvokeAsync(StateHasChanged);
        });

        hubConnection.On<int>("Temperature", (temperature) => 
        {
            dhtTemperature = temperature;
            InvokeAsync(StateHasChanged);
        });

        hubConnection.On<int>("Humidity", (humidity) => 
        {
            dhtHumidity = humidity;
            InvokeAsync(StateHasChanged);
        });

        await hubConnection.StartAsync();
    }
}